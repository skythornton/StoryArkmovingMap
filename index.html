<!DOCTYPE html>
<html>
<head>
    <title>Story Ark Moving Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        body { margin:0; padding:0; }
        #map { width: 100%; height: 100vh; }
    </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
    // Initialize the map centered on South Africa
    const map = L.map('map').setView([-29.5, 24], 6);

    // Add map tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Car icon
    const carIcon = L.icon({
        iconUrl: 'https://cdn-icons-png.flaticon.com/512/743/743007.png',
        iconSize: [40, 40],
        iconAnchor: [20, 20]
    });

    // Marker setup (initially hidden)
    const marker = L.marker([0, 0], {icon: carIcon, opacity: 0}).addTo(map);

    // Animation variables
    let routeCoords = [];
    let index = 0;
    const speed = 1000; // milliseconds per step

    // Fetch the route GeoJSON
    fetch('route.geojson')
        .then(response => {
            if (!response.ok) throw new Error('Failed to load route.geojson');
            return response.json();
        })
        .then(data => {
            console.log('GeoJSON Loaded:', data);

            // Extract point coordinates
            data.features.forEach(feature => {
                if (feature.geometry.type === 'Point') {
                    const [lon, lat] = feature.geometry.coordinates;
                    routeCoords.push([lat, lon]);
                }
            });

            if (routeCoords.length === 0) {
                throw new Error('No valid points found in GeoJSON');
            }

            // Draw the route line
            const routeLine = L.polyline(routeCoords, {color: 'red', weight: 4}).addTo(map);

            // Fit the map to the route
            map.fitBounds(routeLine.getBounds());

            // Initialize marker
            marker.setLatLng(routeCoords[0]);
            marker.setOpacity(1);

            // Start animation
            animate();
        })
        .catch(err => console.error('Error loading GeoJSON:', err));

    // Animation function
    function animate() {
        if (index < routeCoords.length) {
            marker.setLatLng(routeCoords[index]);
            index++;
            setTimeout(animate, speed);
        } else {
            index = 0;
            animate(); // Loop back to start
        }
    }
</script>

</body>
</html>
